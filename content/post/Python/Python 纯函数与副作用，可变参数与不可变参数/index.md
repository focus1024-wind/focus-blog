---
title: Python 纯函数与副作用，可变参数与不可变参数
description: Python 纯函数与副作用，可变参数与不可变参数
date: 2023-04-11
slug: python/pure_function_and_side_effects_and_parameter_variability
image: 
categories:
    - Python
tags:
    - Python
---

# 纯函数与副作用
在Python的函数式编程中，Python既可以在调用时对实参进行修改，也可以通过返回值返回函数调用结果。这样的既有返回值又能修改传参的模式，在进行编程开发时，容易遗漏修改传参对结果的影响。

## 纯函数
**纯函数**：调用函数时不对传参进行修改，函数的调用结果都在函数返回值中体现。

- 相同的输入返回相同的输出
- 使用纯函数的优势在于概念简单、测试方便
- 编写纯函数时要求代码的作用域为本地。具体而言，就是避免使用 `global`，`nonlocal`等语句

## 副作用
**副作用**：简单来说，使函数结果变得不纯的因素都是副作用。

如果函数的调用依赖于外部的状态就无法保证相同的输出。所以，所有的外部交互都有可能带来副作用。

副作用也是方法通用性下降的重要因素，同时副作用也会给程序带来安全隐患和不确定性。副作用不可能完全禁止，但也应尽量控制在可控的范围内。

很多人在编写函数时，通过对调用参数进行修改来返回调用结果，这种方式的函数与外部进行了交互。属于副作用式函数编程。

- 副作用的来源：
  - 用户的输入
  - 配置文件
  - 数据库
  - 调用外部作用域的变量
  - 与外部进行交互
  - ...

# 参数传递
Python作为一个**一切皆对象**的动态型编程语言，其对象可以分为可变对象和不可变对象。
## 不可变对象（值类型）
- Numbers：数值类型
  - int: 整型数
  - float: 浮点数
  - complex: 复数
- bool: 布尔类型
- str: 字符型
- tuple: 元组
- range: 范围对象
- frozenset: 不可变集合
- bytes: 不可变字节数组

## 可变对象（引用类型）
- list: 列表
- dict: 字典
- set: 可变集合
- bytearray: 可变字节数组
- 用户自定义类

## 参数传递方式
函数按照传值的方式分为：
- **值传递**：把调用函数时传递的值赋值到形参当中，对形参的操作不会影响外部的实参变量。
- **引用传递**：把实参引用的内存地址赋值给形参，当对该内存的值进行修改时，会相应的影响到外部实参变量。
> 参数传递方式还包括**地址传递**，在Python这种无指针的高级语言中，不考虑辨别区分地址传递这种类型
```python
a = 123
b = [1, 2, 3]

print(f"id(a) = {id(a)}, id(b) = {id(b)}")


def test(a, b):
    print(f"func id(a) = {id(a)}, id(b) = {id(b)}")


test(a, b)
# id(a) = 140362719137840, id(b) = 140362724287744
# func id(a) = 140362719137840, id(b) = 140362724287744
```
通过上面的代码，可以看到Python可变对象和不可变对象在传递参数时，都是传递的变量指向的内存地址而不是进行的值传递。

Python为了方便内存的管理，都是采用的**引用传递**。在传递参数时，都传递的是对应的内存地址，所以在Python中对可变对象的修改，会引起外部对象的改变。不可变对象因为其特性，对不可变对象的操作效果和值传递具有相同的效果。